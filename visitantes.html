<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Visitantes · Arreglos Discursos</title>
<link href="assets/favicon.svg" rel="icon" type="image/svg+xml"/>
<link href="css/styles.css" rel="stylesheet"/>
</head>
<body class="has-topbar">
<div id="topbar"></div>
<div class="container">
<div id="toastHost"></div>
<div class="row">
<div class="col">
<div class="card pad">
<h2 class="h1" style="margin-bottom:6px;">Visitantes</h2>
<div class="muted">Conferenciantes de otras congregaciones que vienen a Villa Fiad. Guardado en Firestore (<code>visitas</code>). Se puede editar cuando se confirmen arreglos.</div>
<hr class="sep"/>
<form class="grid" id="form" style="grid-template-columns: repeat(6, 1fr); gap:12px;">
<div style="grid-column: span 2;">
<label class="lbl">Fecha (YYYY-MM-DD)</label>
<input class="inp" id="fecha" placeholder="2026-03-07" required=""/>
<div class="small muted">Se guarda con ID = fecha (para autocompletar en Asignaciones).</div>
</div>
<div style="grid-column: span 2;">
<label class="lbl">Nombre del visitante</label>
<input class="inp" id="nombre" placeholder="Nombre Apellido" required=""/>
</div>
<div style="grid-column: span 2;">
<label class="lbl">Congregación (de dónde nos visita)</label>
<input class="inp" id="congregacion" placeholder="Congregación" required=""/>
</div>
<div style="grid-column: span 1;">
<label class="lbl">Bosquejo</label>
<input class="inp" id="bosquejo" inputmode="numeric" placeholder="6"/>
</div>
<div style="grid-column: span 2;">
<label class="lbl">Título (opcional)</label>
<input class="inp" id="titulo" placeholder="Se completa si usás bosquejos"/>
</div>
<div style="grid-column: span 1;">
<label class="lbl">Canción (opcional)</label>
<input class="inp" id="cancion" inputmode="numeric" placeholder="12"/>
</div>
<div style="grid-column: span 3;">
<label class="lbl">Hospitalidad (opcional)</label>
<input class="inp" id="hospitalidad" placeholder="Familia…"/>
</div>
<div style="grid-column: span 3;">
<label class="lbl">Observaciones (opcional)</label>
<input class="inp" id="observaciones" placeholder="Notas…"/>
</div>
<input id="editId" type="hidden"/>
<div class="row" style="grid-column: span 6;">
<button class="btn primary" id="btnGuardar" type="submit">Guardar</button>
<button class="btn" id="btnNuevo" type="button">Nuevo</button>
<button class="btn danger" disabled="" id="btnBorrar" type="button">Borrar</button>
</div>
</form>
<hr class="sep"/>
<div class="row" style="justify-content:space-between; align-items:center;">
<div>
<b>Listado</b>
<div class="small muted">Click en una fila para editar.</div>
</div>
<div class="row">
<input class="inp" id="filtro" placeholder="Filtrar por nombre o congregación…" style="max-width:260px;"/>
<button class="btn" id="btnRefrescar" type="button">Refrescar</button>
</div>
</div>
<div style="height:10px"></div>
<div class="card pad" style="padding:0; overflow:auto;">
<table class="table" id="tabla">
<thead>
<tr>
<th>Fecha</th>
<th>Nombre</th>
<th>Congregación</th>
<th>Bosquejo</th>
<th>Título</th>
<th>Canción</th>
</tr>
</thead>
<tbody id="tbody">
<tr><td class="muted" colspan="6">Cargando…</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<script>
(function(){
  if(!('serviceWorker' in navigator)) return;
  let refreshing = false;
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('./sw.js').then(function(reg){
      // Si hay una versión esperando, activala
      if(reg.waiting) reg.waiting.postMessage({type:'SKIP_WAITING'});

      reg.addEventListener('updatefound', function(){
        var nw = reg.installing;
        if(!nw) return;
        nw.addEventListener('statechange', function(){
          if(nw.state === 'installed' && navigator.serviceWorker.controller){
            nw.postMessage({type:'SKIP_WAITING'});
          }
        });
      });
    }).catch(function(e){
      console.log('SW error', e);
    });

    navigator.serviceWorker.addEventListener('controllerchange', function(){
      if(refreshing) return;
      refreshing = true;
      location.reload();
    });
  });
})();
</script><script src="js/pages/visitantes.js" type="module"></script>
</body>
</html>
